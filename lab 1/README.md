# Классификация сигналов светофора

## Описание программы
Программа предназначена для классификации изображений светофоров по цвету активного сигнала (красный, желтый, зеленый).

## Описание решения
Программа использует компьютерное зрение для определения активного сигнала светофора. Основные этапы обработки:

1. Предобработка изображения:
   - Нормализация размера
   - Размытие по Гауссу для уменьшения шума
   - Преобразование в HSV цветовое пространство

2. Выделение цветов:
   - Создание масок для каждого цвета с помощью cv2.inRange()
   - Морфологические операции для уменьшения шума
   - Анализ контуров для проверки формы и размера сигналов

3. Классификация:
   - Подсчет пикселей каждого цвета
   - Проверка на наличие нескольких активных сигналов
   - Сравнение с адаптивными порогами

### Основные проблемы и решения

1. **Вариативность освещения**
   - Расширенные диапазоны HSV
   - Адаптивные пороги
   - Морфологические операции

2. **Ложные срабатывания**
   - Проверка формы контуров
   - Минимальная площадь области
   - Проверка округлости

3. **Несколько светофоров**
   - Анализ количества контуров
   - Сравнение интенсивности сигналов
   - Классификация как 'unknown' при неоднозначности

## Основные компоненты

### Функции программы

#### setup_logging()
Настраивает и возвращает объект логгера для записи информации о работе программы.

#### create_directories(base_path)
Создает или очищает директории для сохранения классифицированных изображений.

#### write_classification_results(classifications)
Записывает результаты классификации в текстовые файлы для каждого цвета.

#### adjust_thresholds(min_threshold, avg_value, avg_saturation)
Корректирует пороговые значения на основе яркости и насыщенности изображения.

#### analyze_contours(mask, min_area)
Анализирует контуры на маске изображения, проверяя их форму и размер.

#### extract_roi(img)
Выделяет область интереса на изображении для улучшения точности классификации.

#### detect_traffic_light_color(image_path, logger)
Основная функция определения цвета светофора на изображении.

### Параметры классификации

#### Цветовые диапазоны (HSV)
- Красный: [0-8, 100-255, 100-255] и [165-180, 100-255, 100-255]
- Желтый: [22-32, 130-255, 130-255]
- Зеленый: [45-80, 100-255, 100-255]

#### Пороговые множители
- Красный: 1.0
- Желтый: 1.2
- Зеленый: 0.9

## Использование

### Требования
- Python 3.x
- OpenCV (cv2)
- NumPy
- tqdm

### Структура файлов
- Входные изображения: папка `tlights/`
- Результаты классификации: папка `classified_images/`
  - `classified_images/red/`
  - `classified_images/yellow/`
  - `classified_images/green/`
  - `classified_images/unknown/`
- Текстовые файлы с результатами:
  - `red.txt`
  - `yellow.txt`
  - `green.txt`

### Запуск программы
python classification.py

Программа обрабатывает изображения из папки `tlights` и сохраняет результаты в:
- Папки `classified_images/{color}` - отсортированные изображения
- Файлы `{color}.txt` - списки имен файлов для каждого цвета
