# Классификация сигналов светофора

## Описание программы
Программа предназначена для классификации изображений светофоров по цвету активного сигнала (красный, желтый, зеленый).

## Описание решения
Программа использует компьютерное зрение для определения активного сигнала светофора. Основные этапы обработки:

1. Предобработка изображения:
   - Нормализация размера
   - Размытие по Гауссу для уменьшения шума
   - Преобразование в HSV цветовое пространство

2. Выделение цветов:
   - Создание масок для каждого цвета с помощью cv2.inRange()
   - Морфологические операции для уменьшения шума
   - Анализ контуров для проверки формы и размера сигналов

3. Классификация:
   - Подсчет пикселей каждого цвета
   - Проверка на наличие нескольких активных сигналов
   - Сравнение с адаптивными порогами

### Основные проблемы и решения

1. **Вариативность освещения**
   - Расширенные диапазоны HSV
   - Адаптивные пороги
   - Морфологические операции

2. **Ложные срабатывания**
   - Проверка формы контуров
   - Минимальная площадь области
   - Проверка округлости

3. **Несколько светофоров**
   - Анализ количества контуров
   - Сравнение интенсивности сигналов
   - Классификация как 'unknown' при неоднозначности
     
## Путь к решению

### Начальный подход
- Простое определение цвета через HSV маски
- Фиксированные пороги
- Высокий процент ошибок

### Эксперименты и улучшения

1. **Предобработка изображения**
   - ✅ Нормализация размера
   - ❌ CLAHE (не дал значимого улучшения)
   - ✅ Гауссово размытие

2. **Детекция границ**
   - ❌ Canny (усложнил алгоритм без существенных улучшений)
   - ❌ Watershed (слишком сложно для данной задачи)
   - ✅ Простые морфологические операции

3. **Анализ формы**
   - ✅ Проверка округлости контуров
   - ❌ Hough Circles (нестабильные результаты)
   - ✅ Фильтрация по площади

4. **Пороги и параметры**
   - ❌ Фиксированные пороги
   - ✅ Адаптивные пороги на основе размера изображения
   - ✅ Разные множители для разных цветов

5. **Обработка сложных случаев**
   - ✅ Определение нескольких активных сигналов
   - ✅ Проверка соотношения интенсивности сигналов
   - ✅ Расширенные диапазоны для зеленого цвета

## Использование

### Требования
- Python 3.x
- OpenCV (cv2)
- NumPy
- tqdm

### Структура файлов
- Входные изображения: папка `tlights/`
- Результаты классификации: папка `classified_images/`
  - `classified_images/red/`
  - `classified_images/yellow/`
  - `classified_images/green/`
  - `classified_images/unknown/`
- Текстовые файлы с результатами:
  - `red.txt`
  - `yellow.txt`
  - `green.txt`

### Запуск программы
python classification.py

Программа обрабатывает изображения из папки `tlights` и сохраняет результаты в:
- Папки `classified_images/{color}` - отсортированные изображения
- Файлы `{color}.txt` - списки имен файлов для каждого цвета
